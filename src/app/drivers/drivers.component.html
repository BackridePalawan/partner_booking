<app-loading-component *ngIf="loading"></app-loading-component>
<app-sidebar></app-sidebar>
<div class="md:ml-64">
  <app-nav-header [title]="title"></app-nav-header>
  <div class="p-4 w-full flex justify-center items-center">
    <div class="w-full px-3 py-4 md:mt-[96px] mt-[50px] shadow-lg rounded-lg">
      <div class="w-full flex justify-center items-center my-5">
        <div
          (click)="sendlinktoDriver = true"
          class="px-3 py-2 font-bold text-2xl bg-primary text-white rounded-2xl shadow-lg w-[300px] text-center hover:bg-secondary"
        >
          <span><i class="fa-solid fa-user"></i></span>&nbsp;&nbsp;Become a
          Driver
        </div>
      </div>
      <div class="relative overflow-x-auto shadow-md rounded-lg">
        <div class="flex justify-end items-center gap-4">
          <div
            class="flex flex-column flex-row flex-wrap space-y-4 space-y-0 items-center justify-end"
            *ngIf="displayedItems.length != 0 || !onsearch"
          >
            <label for="table-search" class="sr-only">Search</label>
            <div class="relative">
              <div
                *ngIf="loadingpage && !onsearch"
                class="absolute w-full h-full bg-gray-100 flex justify-center items-center rounded-lg"
              >
                Loading...
              </div>
              <div
                class="absolute inset-y-0 left-0 rtl:inset-r-0 rtl:right-0 flex items-center ps-3 pb-3pointer-events-none"
              >
                <svg
                  class="w-5 h-5 text-gray-500 dark:text-gray-400 mb-[12px]"
                  aria-hidden="true"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </div>
              <input
                type="text"
                id="table-search"
                (input)="searchDriverEvent($event)"
                class="block p-2 ps-10 mb-[13px] text-sm text-gray-900 border border-gray-300 rounded-lg w-80 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                placeholder="Search for items"
              />
              <!-- (keyup)="onSearch($event)" -->
            </div>
          </div>
        </div>
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"
        >
          <thead
            class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
          >
            <tr>
              <th scope="col" class="px-6 py-3 text-center">Driver Id</th>
              <th scope="col" class="px-6 py-3 text-center">Driver Name</th>
              <th scope="col" class="px-6 py-3 text-center">Status</th>
              <th scope="col" class="px-6 py-3 text-center">Vehicle</th>
              <th scope="col" class="px-6 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody *ngIf="loadingpage">
            <tr
              class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
            >
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>

              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
            </tr>
            <tr
              class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
            >
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>

              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
            </tr>
            <tr
              class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
            >
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>

              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                Loading .....
              </td>
            </tr>
          </tbody>
          <tbody *ngIf="!loadingpage">
            <tr
              class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
              *ngFor="let item of displayedItems"
            >
              <td class="px-6 py-2 text-black font-bold text-16 text-center">
                {{ item.id }}
              </td>
              <td
                class="px-6 py-2 text-black font-semibold text-16 text-center"
                [class.text-primary]="item.is_online == 1"
              >
                {{ item.name }}
              </td>
              <td
                class="px-6 py-2 text-black font-semibold text-16 text-center"
              >
                {{ item.is_online == 1 ? "Online" : "Offline" }}
              </td>
              <td
                class="px-6 py-2 text-black font-semibold text-16 text-center"
              >
                {{ item.vehicle.car_model.name }} ({{
                  item.vehicle.vehicle_type.name
                }})
              </td>

              <td
                class="px-6 py-2 text-black font-semibold text-16 text-center"
              >
                <div class="flex justify-center gap-2">
                  <a
                    [routerLink]="['/affiliate/driver/details', item.id]"
                    target="_blank"
                    class="px-2 py-2 bg-primary rounded-lg text-white hover:bg-secondary w-[50px]"
                  >
                    <i class="fa-solid fa-eye"></i>
                  </a>
                  <p
                    *ngIf="item.is_active == 1"
                    class="px-2 py-2 bg-red rounded-lg text-white hover:bg-secondary w-[50px]"
                    (click)="deactivateDriver(item.id)"
                  >
                    <i class="fa-solid fa-xmark"></i>
                  </p>
                  <a
                    *ngIf="item.is_active == 0"
                    class="px-2 py-2 bg-primary rounded-lg text-white hover:bg-secondary w-[50px]"
                    (click)="activateDriver(item.id)"
                  >
                    <i class="fa-solid fa-check"></i>
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div
          *ngIf="displayedItems.length == 0 && onsearch"
          class="w-full shadow-lg rounded-lg flex justify-center items-center bg-white"
        >
          <p class="font-bold text-16" [class.text-white]="loadingpage">
            NO {{ filtervalue.toUpperCase() }} ORDERS FOUND
          </p>
        </div>
        <div
          *ngIf="displayedItems.length == 0 && !onsearch"
          class="w-full shadow-lg rounded-lg flex justify-center items-center bg-white"
        >
          <p class="font-bold text-16" [class.text-white]="loadingpage">
            NO RESULTS OF "{{ searchValue }}"
          </p>
        </div>
      </div>
      <nav
        class="flex items-center flex-column flex-wrap md:flex-row justify-between pt-4"
        aria-label="Table navigation"
        *ngIf="displayedItems.length != 0"
      >
        <span
          class="text-sm font-normal text-gray-500 dark:text-gray-400 mb-4 md:mb-0 block w-full md:inline md:w-auto"
          >Showing
          <span class="font-semibold text-gray-900 dark:text-white"
            >{{ from }}-{{ to }}</span
          >
          of
          <span class="font-semibold text-gray-900 dark:text-white">{{
            totalItem
          }}</span></span
        >
        <ul class="inline-flex -space-x-px rtl:space-x-reverse text-sm h-8">
          <li>
            <a
              (click)="prevChangePage()"
              class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
              >Prev</a
            >
          </li>
          <li *ngFor="let item of totalItems">
            <a
              (click)="onPageChange(item.url, item.label)"
              [class.active]="item.active"
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
              >{{ item.label }}</a
            >
          </li>

          <li>
            <a
              (click)="nextChangePage()"
              class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
              >Next</a
            >
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <app-modal *ngIf="sendlinktoDriver">
    <div class="w-[500px] p-5 shadow-lg rounded-2xl bg-primary-dark">
      <div class="text-end">
        <i
          class="fa-solid fa-xmark text-[24px] text-red"
          (click)="sendlinktoDriver = false"
        ></i>
      </div>
      <p class="text-2xl font-bold text-white text-center">Become a Driver</p>
      <form (ngSubmit)="sendLink()" [formGroup]="form">
        <label for="number" class="mb-3 text-white font-bold"
          >Phone Number</label
        >
        <input
          type="text"
          class="w-full rounded-2xl shadow-lg mb-4"
          formControlName="phone"
          placeholder="09*********"
        />
        <label for="email" class="mb-3 text-white font-bold">Email</label>
        <input
          type="email"
          class="w-full rounded-2xl shadow-lg mb-4"
          formControlName="recipient"
          placeholder="Juan@gmail.com"
        />
        <div class="w-full flex justify-center items-center">
          <button
            type="submit"
            class="py-2 px-3 text-white bg-secondary text-16 rounded-2xl"
          >
            Send Driver App Link
          </button>
        </div>
      </form>
    </div>
  </app-modal>
</div>
